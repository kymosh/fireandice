ut_bbox <- c(xmin = -114, ymin = 37, xmax = -109, ymax = 42)
# now plot with all
ggplot() +
geom_sf(data = ut, fill = "grey95", color = "black") +
geom_sf(data = ql1.west, aes(fill = layer), color = NA, alpha = 0.3) +
geom_sf(data = aso.extents, aes(fill = layer), color = NA, alpha = 0.5) +
geom_sf(data = fires.after2012, aes(fill = layer), color = 'red', alpha = 0.15) +
coord_sf(xlim = c(ut_bbox["xmin"], ut_bbox["xmax"]),
ylim = c(ut_bbox["ymin"], ut_bbox["ymax"])) +
scale_fill_manual(name = "Layers",
values = c("ASO Extents" = "deepskyblue3",
"QL1 Lidar Availability" = "purple3",
"Fires within 5 Years prior of Lidar Collection" = "red"),
labels = c("ASO Extents",
"QL1 Lidar Availability",
"Fires within 5 Years\nprior of Lidar Collection")) +
labs(title = "Utah Potential Study Area") +
theme_minimal() +
theme(legend.position = "bottom")
# keep only UT
ut <- us.states %>%
dplyr::filter(name %in% c("Utah", 'Colorado', "Arizona", 'New Mexico', 'Wyoming', 'Idaho'))
# now plot with all
ggplot() +
geom_sf(data = ut, fill = "grey95", color = "black") +
geom_sf(data = ql1.west, aes(fill = layer), color = NA, alpha = 0.3) +
geom_sf(data = aso.extents, aes(fill = layer), color = NA, alpha = 0.5) +
geom_sf(data = fires.after2012, aes(fill = layer), color = 'red', alpha = 0.15) +
coord_sf(xlim = c(ut_bbox["xmin"], ut_bbox["xmax"]),
ylim = c(ut_bbox["ymin"], ut_bbox["ymax"])) +
scale_fill_manual(name = "Layers",
values = c("ASO Extents" = "deepskyblue3",
"QL1 Lidar Availability" = "purple3",
"Fires within 5 Years prior of Lidar Collection" = "red"),
labels = c("ASO Extents",
"QL1 Lidar Availability",
"Fires within 5 Years\nprior of Lidar Collection")) +
labs(title = "Utah Potential Study Area") +
theme_minimal() +
theme(legend.position = "bottom")
# keep only UT
ut <- us.states %>%
dplyr::filter(name %in% c("Utah", 'Colorado', "Arizona", 'New Mexico', 'Wyoming', 'Idaho'))
# now plot with all
ggplot() +
geom_sf(data = ut, fill = "grey95", color = "black") +
geom_sf(data = ql1.west, aes(fill = layer), color = NA, alpha = 0.3) +
geom_sf(data = aso.extents, aes(fill = layer), color = NA, alpha = 0.5) +
geom_sf(data = fires.after2012, aes(fill = layer), color = 'red', alpha = 0.15) +
coord_sf(xlim = c(ut_bbox["xmin"], ut_bbox["xmax"]),
ylim = c(ut_bbox["ymin"], ut_bbox["ymax"])) +
labs(title = "Utah Potential Study Area") +
theme_minimal() +
theme(legend.position = "bottom")
# now plot with all
ggplot() +
geom_sf(data = ut, fill = "grey95", color = "black") +
geom_sf(data = ql1.west, aes(fill = layer), color = NA, alpha = 0.3) +
geom_sf(data = aso.extents, aes(fill = layer), color = NA, alpha = 0.5) +
geom_sf(data = fires.after2012, aes(fill = layer), color = 'red', alpha = 0.15) +
coord_sf(xlim = c(ut_bbox["xmin"], ut_bbox["xmax"]),
ylim = c(ut_bbox["ymin"], ut_bbox["ymax"])) +
scale_fill_manual(name = ,
values = c("ASO Extents" = "deepskyblue3",
"QL1 Lidar Availability" = "purple3",
"Fires within 5 Years prior of Lidar Collection" = "red"),
labels = c("ASO Extents",
"QL1 Lidar Availability",
"Fires within 5 Years\nprior of Lidar Collection")) +
labs(title = "Utah Potential Study Area") +
theme_minimal() +
theme(legend.position = "bottom")
# now plot with all
ggplot() +
geom_sf(data = ut, fill = "grey95", color = "black") +
geom_sf(data = ql1.west, aes(fill = layer), color = NA, alpha = 0.3) +
geom_sf(data = aso.extents, aes(fill = layer), color = NA, alpha = 0.5) +
geom_sf(data = fires.after2012, aes(fill = layer), color = 'red', alpha = 0.15) +
coord_sf(xlim = c(ut_bbox["xmin"], ut_bbox["xmax"]),
ylim = c(ut_bbox["ymin"], ut_bbox["ymax"])) +
scale_fill_manual(name = ,
values = c("ASO extents" = "deepskyblue3",
"QL1 lidar availability" = "purple3",
"Fires within 5 years prior of lidar collection" = "red"),
labels = c("ASO extents",
"QL1 lidar availability",
"Fires within 5 years\nprior of lidar collection")) +
labs(title = "Utah Potential Study Area") +
theme_minimal() +
theme(legend.position = "bottom")
# now plot with all
ggplot() +
geom_sf(data = ut, fill = "grey95", color = "black") +
geom_sf(data = ql1.west, aes(fill = layer), color = NA, alpha = 0.3) +
geom_sf(data = aso.extents, aes(fill = layer), color = NA, alpha = 0.5) +
geom_sf(data = fires.after2012, aes(fill = layer), color = 'red', alpha = 0.15) +
coord_sf(xlim = c(ut_bbox["xmin"], ut_bbox["xmax"]),
ylim = c(ut_bbox["ymin"], ut_bbox["ymax"])) +
scale_fill_manual(name = "Layers",
values = c("ASO Extents" = "deepskyblue3",
"QL1 Lidar Availability" = "purple3",
"Fires within 5 Years prior of Lidar Collection" = "red"),
labels = c("ASO extents",
"QL1 lidar availability",
"Fires within 5 years\nprior of lidar collection")) +
labs(title = "Utah Potential Study Area") +
theme_minimal() +
theme(legend.position = "bottom")
dem <- rast(here())
dem <- rast(here('data', 'data', 'raw', 'background_variables', 'tif', 'DEM_creek.tif'))
dem <- rast(here('data', 'raw', 'background_variables', 'tif', 'DEM_creek.tif'))
res(dem)
knitr::opts_chunk$set(
echo = TRUE,
message = FALSE,
warning = FALSE,
collapse = TRUE,
comment = '#>'
)
packages <- (c('here', 'exactextractr', 'raster', 'sf', 'terra', 'geodata', 'tidyverse', 'spatialEco', 'patchwork', 'knitr', 'dplyr'))
install.packages(setdiff(packages, rownames(installed.packages())))
lapply(packages, library, character.only = TRUE)
hucs <- st_read(here('data', 'raw', 'background_variables', 'shp', 'ACE_HUC12s_WebMerc_1mXY.shp'))
creek.fire <- st_read(here('data', 'raw', 'fire_info', 'shp', 'creek_fire_perimeter.shp'))
# change crs to WGS.84
if (st_crs(hucs) != st_crs(creek.fire)) {
creek.fire.84 <- st_transform(creek.fire, st_crs(hucs))
}
# hucs that intersect creek fire boundary
creek.hucs <- hucs %>%
st_filter(creek.fire.84, .predicate = st_intersects)
# View result
plot(st_geometry(creek.hucs), col = adjustcolor('blue', alpha.f = 0.5), main = 'Creek Fire Intersecting HUCs')
plot(st_geometry(creek.fire.84), add = TRUE, border = 'red')
# dissolve into single polygon
creek.study.extent <- creek.hucs %>%
st_union() %>%
st_as_sf()
packages <- c( 'here', 'ggplot2',
'tidyverse', 'terra', 'sf', 'rnaturalearth', 'rnaturalearthdata', 'rgeos')
install.packages(setdiff(packages, rownames(installed.packages())))
lapply(packages, library, character.only = TRUE)
hucs <- st_read(here('data', 'raw', 'background_variables', 'shp', 'ACE_HUC12s_WebMerc_1mXY.shp'))
crs(creek.fire, describe = T)$code
crs(hucs, describe = T)$code
# change crs to WGS.84
creek.fire.32611 <- st_transform(creek.fire, crs = 32611)
hucs.32611 <- st_transform(hucs, crs = 32611)
# hucs that intersect creek fire boundary
creek.hucs <- hucs.32611 %>%
st_filter(creek.fire.32611, .predicate = st_intersects)
# View result
plot(st_geometry(creek.hucs), col = adjustcolor('blue', alpha.f = 0.5), main = 'Creek Fire Intersecting HUCs')
plot(st_geometry(creek.fire.32611), add = TRUE, border = 'red')
# get California basemap
states <- ne_states(country = 'United States of America', returnclass = 'sf')
california <- states %>% dplyr::filter(name == 'California')
california.32611 <- st_transform(california, 32611)
# Get the bounding box of the Creek Fire
bbox <- st_bbox(creek.fire.32611)
# Calculate center and expand bbox
x_center <- (bbox['xmin'] + bbox['xmax']) / 2
y_center <- (bbox['ymin'] + bbox['ymax']) / 2
x_range <- (bbox['xmax'] - bbox['xmin']) / 2
y_range <- (bbox['ymax'] - bbox['ymin']) / 2
# New expanded bounding box
expanded_bbox <- c(
xmin = x_center - x_range,
xmax = x_center + x_range,
ymin = y_center - y_range,
ymax = y_center + y_range
)
# Plot
ggplot() +
geom_sf(data = california.32611, fill = 'gray95', color = 'gray70') +
geom_sf(data = creek.hucs, fill = adjustcolor('deepskyblue3', alpha.f = 0.3), color = 'deepskyblue4', size = 0.3) +
geom_sf(data = creek.fire.32611, fill = adjustcolor('red3', alpha.f = 0.4), color = 'red3', size = 0.4) +
coord_sf(
xlim = c(expanded_bbox['xmin'], expanded_bbox['xmax']),
ylim = c(expanded_bbox['ymin'], expanded_bbox['ymax']),
expand = FALSE
) +
theme_minimal() +
labs(
title = 'Creek Fire Perimeter and Intersecting HUCs',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90')
)
# zoomed-in version around Creek Fire
ggplot() +
geom_sf(data = california.32611, fill = 'gray95', color = 'gray70') +
geom_sf(data = creek.hucs, fill = adjustcolor('deepskyblue3', alpha.f = 0.3),
color = 'deepskyblue4', size = 0.3) +
geom_sf(data = creek.fire.32611, fill = adjustcolor('red3', alpha.f = 0.4),
color = 'red3', size = 0.4) +
coord_sf(
xlim = c(bbox['xmin'], bbox['xmax']),
ylim = c(bbox['ymin'], bbox['ymax']),
expand = FALSE
) +
theme_minimal() +
labs(
title = 'Creek Fire Perimeter and Intersecting HUCs (Zoomed In)',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90')
)
# zoomed-in version around Creek Fire
huc.bbox <- st_bbox(creek.hucs)
zoom.bbox <- c(
xmin = huc.bbox['xmin'] - 5000,
xmax = huc.bbox['xmax'] + 5000,
ymin = huc.bbox['ymin'] - 5000,
ymax = huc.bbox['ymax'] + 5000
)
# zoomed-in version around Creek Fire
huc.bbox <- st_bbox(creek.hucs)
zoom.bbox <- c(
xmin = huc.bbox['xmin'] - 5000,
xmax = huc.bbox['xmax'] + 5000,
ymin = huc.bbox['ymin'] - 5000,
ymax = huc.bbox['ymax'] + 5000
)
ggplot() +
geom_sf(data = california.32611, fill = 'gray95', color = 'gray70') +
geom_sf(data = creek.hucs, fill = adjustcolor('deepskyblue3', alpha.f = 0.3),
color = 'deepskyblue4', size = 0.3) +
geom_sf(data = creek.fire.32611, fill = adjustcolor('red3', alpha.f = 0.4),
color = 'red3', size = 0.4) +
coord_sf(
xlim = c(zoom.bbox['xmin'], zoom.bbox['xmax']),
ylim = c(zoom.bbox['ymin'], zoom.bbox['ymax']),
expand = F
) +
theme_minimal() +
labs(
title = 'Creek Fire Perimeter and Intersecting HUCs (Zoomed to HUC extent)',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90')
)
# zoomed-in version around Creek Fire
huc.bbox <- st_bbox(creek.hucs)
zoom.bbox <- c(
xmin = huc.bbox['xmin'] - 5000,
xmax = huc.bbox['xmax'] + 5000,
ymin = huc.bbox['ymin'] - 5000,
ymax = huc.bbox['ymax'] + 5000
)
ggplot() +
geom_sf(data = california.32611, fill = 'gray95', color = 'gray70') +
geom_sf(data = creek.hucs,
fill = adjustcolor('deepskyblue3', alpha.f = 0.3),
color = 'deepskyblue4', size = 0.3) +
geom_sf(data = creek.fire.32611,
fill = adjustcolor('red3', alpha.f = 0.4),
color = 'red3', size = 0.4) +
coord_sf(
xlim = c(zoom.bbox['xmin'], zoom.bbox['xmax']),
ylim = c(zoom.bbox['ymin'], zoom.bbox['ymax']),
expand = FALSE
) +
theme_minimal() +
labs(
title = 'Creek Fire Perimeter and Intersecting HUCs (Zoomed to HUC extent)',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90')
)
crs(california.32611, describe = T)$code
crs(creek.hucs, describe = T)$code
# zoomed-in version around Creek Fire
huc.bbox <- st_bbox(creek.hucs)
zoom.bbox <- c(
xmin = huc.bbox['xmin'] - 5000,
xmax = huc.bbox['xmax'] + 5000,
ymin = huc.bbox['ymin'] - 5000,
ymax = huc.bbox['ymax'] + 5000
)
ggplot() +
geom_sf(data = california.32611, fill = 'gray95', color = 'gray70') +
geom_sf(data = creek.hucs,
fill = adjustcolor('deepskyblue3', alpha.f = 0.3),
color = 'deepskyblue4', size = 0.3) +
geom_sf(data = creek.fire.32611,
fill = adjustcolor('red3', alpha.f = 0.4),
color = 'red3', size = 0.4) +
coord_sf(
xlim = c(zoom.bbox['xmin'], zoom.bbox['xmax']),
ylim = c(zoom.bbox['ymin'], zoom.bbox['ymax']),
expand = FALSE
) +
theme_minimal() +
labs(
title = 'Creek Fire Perimeter and Intersecting HUCs (Zoomed to HUC extent)',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90')
)
# zoomed-in version around Creek Fire
huc.bbox <- st_bbox(creek.hucs)
zoom.bbox <- c(
xmin = huc.bbox['xmin'] - 5000,
xmax = huc.bbox['xmax'] + 5000,
ymin = huc.bbox['ymin'] - 5000,
ymax = huc.bbox['ymax'] + 5000
)
ggplot() +
geom_sf(data = california.32611, fill = 'gray95', color = 'gray70') +
geom_sf(data = creek.hucs,
fill = adjustcolor('deepskyblue3', alpha.f = 0.3),
color = 'deepskyblue4', size = 0.3) +
geom_sf(data = creek.fire.32611,
fill = adjustcolor('red3', alpha.f = 0.4),
color = 'red3', size = 0.4) +
coord_sf(
xlim = c(zoom.bbox['xmin'], zoom.bbox['xmax']),
ylim = c(zoom.bbox['ymin'], zoom.bbox['ymax']),
expand = FALSE
) +
theme_minimal() +
labs(
title = 'Creek Fire Perimeter and Intersecting HUCs (Zoomed to HUC extent)',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90')
)
# zoomed-in version around Creek Fire
# Bounding box around HUCs, with optional padding
huc.bbox <- st_bbox(creek.hucs)
zoom.bbox <- c(
xmin = huc.bbox['xmin'] - 5000,
xmax = huc.bbox['xmax'] + 5000,
ymin = huc.bbox['ymin'] - 5000,
ymax = huc.bbox['ymax'] + 5000
)
# Zoomed-in map without CA background
ggplot() +
geom_sf(data = creek.hucs,
fill = adjustcolor('deepskyblue3', alpha.f = 0.3),
color = 'deepskyblue4', size = 0.3) +
geom_sf(data = creek.fire.32611,
fill = adjustcolor('red3', alpha.f = 0.4),
color = 'red3', size = 0.4) +
coord_sf(
xlim = c(zoom.bbox['xmin'], zoom.bbox['xmax']),
ylim = c(zoom.bbox['ymin'], zoom.bbox['ymax']),
expand = FALSE
) +
theme_minimal() +
labs(
title = 'Creek Fire Perimeter and Intersecting HUCs',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90')
)
# Zoomed-in map without CA background
ggplot() +
geom_sf(data = creek.hucs,
fill = adjustcolor('deepskyblue3', alpha.f = 0.3),
color = 'deepskyblue4', size = 0.3) +
geom_sf(data = creek.fire.32611,
fill = adjustcolor('red3', alpha.f = 0.4),
color = 'red3', size = 0.4) +
coord_sf(
xlim = c(zoom.bbox['xmin'], zoom.bbox['xmax']),
ylim = c(zoom.bbox['ymin'], zoom.bbox['ymax']),
expand = T
) +
theme_minimal() +
labs(
title = 'Creek Fire Perimeter and Intersecting HUCs',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90')
)
# Layer for legend
hucs$layer <- 'All HUCs'
creek.hucs$layer <- 'Intersecting HUCs'
creek.fire.32611$layer <- 'Creek Fire'
ggplot() +
# background HUCs (all of CA)
geom_sf(data = hucs, aes(fill = layer),
color = 'gray70', size = 0.2, alpha = 0.2) +
# highlighted intersecting HUCs
geom_sf(data = creek.hucs, aes(fill = layer),
color = 'deepskyblue4', size = 0.3, alpha = 0.4) +
# fire perimeter
geom_sf(data = creek.fire.32611, aes(fill = layer),
color = 'red3', size = 0.4, alpha = 0.4) +
# colors for legend
scale_fill_manual(
name = 'Layer',
values = c(
'All HUCs' = 'gray80',
'Intersecting HUCs' = 'deepskyblue3',
'Creek Fire' = 'red3'
)
) +
# zoom to creek.hucs extent
coord_sf(
xlim = c(zoom.bbox['xmin'], zoom.bbox['xmax']),
ylim = c(zoom.bbox['ymin'], zoom.bbox['ymax']),
expand = FALSE
) +
theme_minimal() +
labs(
title = 'Creek Fire and Surrounding HUCs',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90'),
legend.position = 'right'
)
zoom.window <- st_as_sfc(st_bbox(zoom.bbox, crs = 32611))
hucs.zoom <- st_intersection(hucs, zoom.window)
zoom.window <- st_as_sfc(st_bbox(zoom.bbox, crs = 32611))
# Get bbox of creek.hucs and buffer it
huc.bbox <- st_bbox(creek.hucs)
zoom.bbox <- st_bbox(c(
xmin = huc.bbox['xmin'] - 5000,
xmax = huc.bbox['xmax'] + 5000,
ymin = huc.bbox['ymin'] - 5000,
ymax = huc.bbox['ymax'] + 5000
), crs = st_crs(creek.hucs))
# Now make polygon from bbox
zoom.window <- st_as_sfc(zoom.bbox)
# Clip hucs to zoom window
hucs.zoom <- st_intersection(hucs, zoom.window)
# zoomed-out plot of all of California
ggplot() +
geom_sf(data = california.32611, fill = 'gray95', color = 'gray70') +
geom_sf(data = creek.hucs, fill = adjustcolor('deepskyblue3', alpha.f = 0.3), color = 'deepskyblue4', size = 0.3) +
geom_sf(data = creek.fire.32611, fill = adjustcolor('red3', alpha.f = 0.4), color = 'red3', size = 0.4) +
coord_sf(
xlim = c(expanded_bbox['xmin'], expanded_bbox['xmax']),
ylim = c(expanded_bbox['ymin'], expanded_bbox['ymax']),
expand = FALSE
) +
theme_minimal() +
labs(
title = 'Creek Fire Perimeter and Intersecting HUCs',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90')
)
# zoomed-in version around Creek Fire
# Bounding box around HUCs, with padding
huc.bbox <- st_bbox(creek.hucs)
zoom.bbox <- c(
xmin = huc.bbox['xmin'] - 5000,
xmax = huc.bbox['xmax'] + 5000,
ymin = huc.bbox['ymin'] - 5000,
ymax = huc.bbox['ymax'] + 5000
)
# Zoomed-in map without CA background
ggplot() +
geom_sf(data = creek.hucs,
fill = adjustcolor('deepskyblue3', alpha.f = 0.3),
color = 'deepskyblue4', size = 0.3) +
geom_sf(data = creek.fire.32611,
fill = adjustcolor('red3', alpha.f = 0.4),
color = 'red3', size = 0.4) +
coord_sf(
xlim = c(zoom.bbox['xmin'], zoom.bbox['xmax']),
ylim = c(zoom.bbox['ymin'], zoom.bbox['ymax']),
expand = T
) +
theme_minimal() +
labs(
title = 'Creek Fire Perimeter and Intersecting HUCs',
caption = 'Data sources: USGS, CalFire, HUC12 boundaries'
) +
theme(
plot.title = element_text(size = 14, face = 'bold'),
panel.background = element_rect(fill = 'white'),
panel.grid = element_line(color = 'gray90')
)
citation("cloud2trees")
install.packages('cloud2trees')
citation("cloud2trees")
install.packages("pkgbuild")
